<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JavaScript/TypeScript SDK - ScoutQuest Documentation</title>
    <link rel="stylesheet" href="../assets/css/style.css">
    <link rel="stylesheet" href="../assets/css/docs.css">
    <!-- Prism.js CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
    <link rel="icon" type="image/x-icon" href="../assets/images/favicon.ico">
</head>

<body>
    <header class="header">
        <nav class="nav container">
            <div class="nav__brand">
                <a href="../index.html" class="nav__brand">
                    <img src="../assets/images/logo.svg" alt="ScoutQuest Logo" class="nav__logo">
                    <h1 class="nav__title">ScoutQuest</h1>
                </a>
            </div>
            <div class="nav__menu" id="nav-menu">
                <ul class="nav__list">
                    <li class="nav__item"><a href="../index.html" class="nav__link">Home</a></li>
                    <li class="nav__item"><a href="../index.html#features" class="nav__link">Features</a></li>
                    <li class="nav__item"><a href="../index.html#getting-started" class="nav__link">Get Started</a></li>
                    <li class="nav__item"><a href="../index.html#docs" class="nav__link">Documentation</a></li>
                    <li class="nav__item">
                        <a href="https://github.com/RomainDECOSTER/scoutquest" class="nav__link nav__link--github"
                            target="_blank">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                <path
                                    d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z" />
                            </svg>
                            GitHub
                        </a>
                    </li>
                </ul>
            </div>
            <div class="nav__toggle" id="nav-toggle">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </nav>
    </header>

    <main class="docs-main">
        <div class="container">
            <div class="docs-layout">
                <aside class="docs-sidebar">
                    <nav class="docs-nav">
                        <div class="docs-nav__section">
                            <h3 class="docs-nav__title">Quick Start</h3>
                            <ul class="docs-nav__list">
                                <li class="docs-nav__item">
                                    <a href="installation.html" class="docs-nav__link">Installation Guide</a>
                                </li>
                                <li class="docs-nav__item">
                                    <a href="first-service.html" class="docs-nav__link">Your First Service</a>
                                </li>
                                <li class="docs-nav__item">
                                    <a href="configuration.html" class="docs-nav__link">Configuration</a>
                                </li>
                                <li class="docs-nav__item">
                                    <a href="troubleshooting.html" class="docs-nav__link">Troubleshooting</a>
                                </li>
                            </ul>
                        </div>

                        <div class="docs-nav__section">
                            <h3 class="docs-nav__title">SDK Documentation</h3>
                            <ul class="docs-nav__list">
                                <li class="docs-nav__item">
                                    <a href="js-sdk.html" class="docs-nav__link active">JavaScript/TypeScript SDK</a>
                                </li>
                                <li class="docs-nav__item">
                                    <a href="rust-sdk.html" class="docs-nav__link">Rust SDK</a>
                                </li>
                                <li class="docs-nav__item">
                                    <a href="api-reference.html" class="docs-nav__link">REST API Reference</a>
                                </li>
                            </ul>
                        </div>

                        <div class="docs-nav__section">
                            <h3 class="docs-nav__title">Advanced Topics</h3>
                            <ul class="docs-nav__list">
                                <li class="docs-nav__item">
                                    <a href="health-checking.html" class="docs-nav__link">Health Checking</a>
                                </li>
                                <li class="docs-nav__item">
                                    <a href="monitoring.html" class="docs-nav__link">Monitoring & Observability</a>
                                </li>
                                <li class="docs-nav__item">
                                    <a href="production.html" class="docs-nav__link">Production Deployment</a>
                                </li>
                            </ul>
                        </div>
                    </nav>
                </aside>

                <div class="docs-content">
                    <div class="docs-breadcrumb">
                        <a href="../index.html">ScoutQuest</a>
                        <span>/</span>
                        <a href="../index.html#docs">Documentation</a>
                        <span>/</span>
                        <span class="current">JavaScript/TypeScript SDK</span>
                    </div>

                    <article class="docs-article">
                        <header class="docs-header">
                            <h1>JavaScript/TypeScript SDK</h1>
                            <p class="docs-lead">
                                Complete guide to using ScoutQuest in JavaScript and TypeScript applications.
                            </p>
                            <div class="docs-meta">
                                <span class="docs-version">Version: 1.0.0</span>
                                <a href="https://www.npmjs.com/package/scoutquest-js" target="_blank" class="docs-npm">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M0 7v9l6.5 3.7V7H0zm6.5 0v12.5H12V7H6.5zm6.5 0v9H24V7H13z" />
                                    </svg>
                                    View on NPM
                                </a>
                            </div>
                        </header>

                        <div class="docs-body">
                            <section class="docs-section">
                                <h2>Installation</h2>
                                <div class="installation-tabs">
                                    <div class="tab-buttons">
                                        <button class="tab-btn active" data-tab="npm">NPM</button>
                                        <button class="tab-btn" data-tab="yarn">Yarn</button>
                                        <button class="tab-btn" data-tab="pnpm">PNPM</button>
                                        <button class="tab-btn" data-tab="bun">Bun</button>
                                    </div>

                                    <div class="tab-content active" id="npm">
                                        <div class="code-block">
                                            <pre><code>npm install scoutquest-js</code></pre>
                                        </div>
                                    </div>

                                    <div class="tab-content" id="yarn">
                                        <div class="code-block">
                                            <pre><code>yarn add scoutquest-js</code></pre>
                                        </div>
                                    </div>

                                    <div class="tab-content" id="pnpm">
                                        <div class="code-block">
                                            <pre><code>pnpm add scoutquest-js</code></pre>
                                        </div>
                                    </div>

                                    <div class="tab-content" id="bun">
                                        <div class="code-block">
                                            <pre><code>bun add scoutquest-js</code></pre>
                                        </div>
                                    </div>
                                </div>
                            </section>

                            <section class="docs-section">
                                <h2>Quick Start</h2>
                                <p>Get started with ScoutQuest in just a few lines of code:</p>

                                <div class="code-block">
                                    <pre><code>import { ScoutQuestClient } from 'scoutquest-js';

// Create client
const client = new ScoutQuestClient('http://localhost:8080');

// Register your service
const instance = await client.registerService('my-service', 'localhost', 3000, {
  tags: ['api', 'v1'],
  metadata: {
    version: '1.0.0',
    environment: 'production'
  }
});

console.log(`Service registered with ID: ${instance.id}`);

// Discover other services
const userService = await client.discoverService('user-service');
console.log(`User service found at: ${userService.host}:${userService.port}`);

// Make HTTP calls through ScoutQuest
const users = await client.get('user-service', '/api/users');
console.log('Users:', users.data);</code></pre>
                                </div>
                            </section>

                            <section class="docs-section">
                                <h2>Client Configuration</h2>

                                <h3>Basic Configuration</h3>
                                <div class="code-block">
                                    <pre><code>import { ScoutQuestClient } from 'scoutquest-js';

const client = new ScoutQuestClient('http://localhost:8080', {
  timeout: 5000,        // Request timeout in milliseconds
  retries: 3,          // Number of retry attempts
  retryDelay: 1000,    // Delay between retries in milliseconds
  headers: {           // Default headers for all requests
    'User-Agent': 'MyApp/1.0.0'
  }
});</code></pre>
                                </div>

                                <h3>Advanced Configuration</h3>
                                <div class="code-block">
                                    <pre><code>const client = new ScoutQuestClient('http://localhost:8080', {
  // HTTP client configuration
  timeout: 10000,
  retries: 5,
  retryDelay: 2000,

  // Custom retry logic
  retryCondition: (error) => {
    return error.response?.status >= 500 || error.code === 'ECONNRESET';
  },

  // Request/Response interceptors
  requestInterceptor: (config) => {
    config.headers['X-Request-ID'] = generateRequestId();
    return config;
  },

  responseInterceptor: (response) => {
    console.log(`Request to ${response.config.url} took ${response.duration}ms`);
    return response;
  },

  // Error handling
  errorHandler: (error) => {
    console.error('ScoutQuest error:', error);
    // Custom error reporting logic
  }
});</code></pre>
                                </div>
                            </section>

                            <section class="docs-section">
                                <h2>Service Registration</h2>

                                <h3>Basic Registration</h3>
                                <div class="code-block">
                                    <pre><code>// Simple registration
const instance = await client.registerService('api-service', 'localhost', 3000);

// With tags and metadata
const instance = await client.registerService('api-service', 'localhost', 3000, {
  tags: ['api', 'v1', 'production'],
  metadata: {
    version: '1.2.3',
    environment: 'production',
    region: 'us-east-1'
  }
});</code></pre>
                                </div>

                                <h3>Health Check Configuration</h3>
                                <div class="code-block">
                                    <pre><code>const instance = await client.registerService('api-service', 'localhost', 3000, {
  tags: ['api', 'v1'],
  healthCheck: {
    path: '/health',           // Health check endpoint
    interval: 30,              // Check interval in seconds
    timeout: 5,                // Timeout for health checks in seconds
    retries: 3,                // Number of failed checks before marking unhealthy
    successThreshold: 2        // Number of successful checks to mark healthy
  }
});</code></pre>
                                </div>

                                <h3>Service Deregistration</h3>
                                <div class="code-block">
                                    <pre><code>// Deregister specific instance
await client.deregisterService(instance.id);

// Deregister all instances of a service
await client.deregisterAllInstances('api-service');

// Graceful shutdown with cleanup
process.on('SIGTERM', async () => {
  console.log('Gracefully shutting down...');
  await client.deregisterService(instance.id);
  process.exit(0);
});</code></pre>
                                </div>
                            </section>

                            <section class="docs-section">
                                <h2>Service Discovery</h2>

                                <h3>Basic Discovery</h3>
                                <div class="code-block">
                                    <pre><code>// Discover a service (returns single instance)
const instance = await client.discoverService('user-service');
console.log(`Service at: ${instance.host}:${instance.port}`);

// List all services
const services = await client.listServices();
services.forEach(service => {
  console.log(`Service: ${service.name} - ${service.instanceCount} instances`);
});

// List instances of a specific service
const instances = await client.listServiceInstances('user-service');
instances.forEach(instance => {
  console.log(`Instance: ${instance.id} at ${instance.host}:${instance.port}`);
});</code></pre>
                                </div>

                                <h3>Advanced Discovery with Filtering</h3>
                                <div class="code-block">
                                    <pre><code>// Discover with tag filtering
const instance = await client.discoverService('user-service', {
  tags: ['v1', 'production'],    // Service must have these tags
  excludeTags: ['deprecated'],   // Service must not have these tags
  metadata: {                    // Service metadata filters
    region: 'us-east-1',
    version: '^1.2.0'           // Semver matching
  }
});

// Custom discovery logic
const instance = await client.discoverService('user-service', {
  filter: (instances) => {
    // Custom filtering logic
    return instances.filter(inst =>
      inst.metadata.load < 0.8 &&
      inst.metadata.responseTime < 100
    );
  }
});</code></pre>
                                </div>
                            </section>

                            <section class="docs-section">
                                <h2>HTTP Calls Through Service Discovery</h2>

                                <h3>Basic HTTP Methods</h3>
                                <div class="code-block">
                                    <pre><code>// GET request
const users = await client.get('user-service', '/api/users');
console.log(users.data);

// GET with query parameters
const user = await client.get('user-service', '/api/users/:id', {
  params: { id: '123' },
  query: { include: 'profile' }
});

// POST request
const newUser = await client.post('user-service', '/api/users', {
  data: {
    name: 'John Doe',
    email: 'john@example.com'
  }
});

// PUT request
const updatedUser = await client.put('user-service', '/api/users/:id', {
  params: { id: '123' },
  data: { name: 'John Smith' }
});

// DELETE request
await client.delete('user-service', '/api/users/:id', {
  params: { id: '123' }
});</code></pre>
                                </div>

                                <h3>Advanced HTTP Configuration</h3>
                                <div class="code-block">
                                    <pre><code>// Request with custom headers and timeout
const response = await client.get('user-service', '/api/users', {
  headers: {
    'Authorization': 'Bearer ' + token,
    'X-Client-Version': '1.0.0'
  },
  timeout: 30000,
  retries: 5,
  retryDelay: 1000
});

// Request with custom service selection
const response = await client.post('user-service', '/api/users', {
  data: userData,
  serviceOptions: {
    tags: ['v1'],              // Use only v1 instances
    preferLocal: true,         // Prefer instances on same host
    strategy: 'round-robin'    // Load balancing strategy
  }
});

// Raw HTTP request with full control
const response = await client.request('user-service', {
  method: 'POST',
  path: '/api/users',
  data: userData,
  headers: { 'Content-Type': 'application/json' },
  timeout: 15000
});</code></pre>
                                </div>
                            </section>

                            <section class="docs-section">
                                <h2>Error Handling</h2>

                                <div class="code-block">
                                    <pre><code>import {
  ScoutQuestClient,
  ServiceNotFoundError,
  ServiceUnavailableError,
  ScoutQuestError
} from 'scoutquest-js';

try {
  const instance = await client.discoverService('user-service');
  const users = await client.get('user-service', '/api/users');
} catch (error) {
  if (error instanceof ServiceNotFoundError) {
    console.error('Service not found:', error.serviceName);
    // Handle service not found
  } else if (error instanceof ServiceUnavailableError) {
    console.error('Service unavailable:', error.message);
    // Handle service down/unhealthy
  } else if (error instanceof ScoutQuestError) {
    console.error('ScoutQuest error:', error.message);
    // Handle other ScoutQuest-specific errors
  } else {
    console.error('Unexpected error:', error);
    // Handle other errors
  }
}</code></pre>
                                </div>

                                <h3>Custom Error Handler</h3>
                                <div class="code-block">
                                    <pre><code>const client = new ScoutQuestClient('http://localhost:8080', {
  errorHandler: (error, context) => {
    // Log error details
    console.error(`Error in ${context.operation}:`, {
      error: error.message,
      service: context.serviceName,
      endpoint: context.endpoint,
      timestamp: new Date().toISOString()
    });

    // Send to monitoring system
    monitoring.recordError(error, context);

    // Custom retry logic
    if (error.code === 'ECONNRESET' && context.retryCount < 3) {
      return { shouldRetry: true, delay: 2000 };
    }

    return { shouldRetry: false };
  }
});</code></pre>
                                </div>
                            </section>

                            <section class="docs-section">
                                <h2>TypeScript Support</h2>

                                <p>ScoutQuest provides full TypeScript support with comprehensive type definitions:</p>

                                <h3>Type Definitions</h3>
                                <div class="code-block">
                                    <pre><code>import {
  ScoutQuestClient,
  ServiceInstance,
  ServiceRegistration,
  ServiceDiscoveryOptions,
  HttpRequestOptions
} from 'scoutquest-js';

// Custom service interface
interface UserService {
  id: string;
  name: string;
  email: string;
}

// Typed HTTP calls
const users = await client.get&lt;UserService[]&gt;('user-service', '/api/users');
const user = await client.post&lt;UserService&gt;('user-service', '/api/users', {
  data: { name: 'John', email: 'john@example.com' }
});

// Typed service registration
const registration: ServiceRegistration = {
  tags: ['api', 'v1'],
  metadata: {
    version: '1.0.0',
    capabilities: ['users', 'auth']
  },
  healthCheck: {
    path: '/health',
    interval: 30
  }
};

const instance = await client.registerService('api-service', 'localhost', 3000, registration);</code></pre>
                                </div>

                                <h3>Custom Type Guards</h3>
                                <div class="code-block">
                                    <pre><code>import { ServiceInstance } from 'scoutquest-js';

// Type guard for service capabilities
function hasCapability(instance: ServiceInstance, capability: string): boolean {
  return instance.metadata?.capabilities?.includes(capability) ?? false;
}

// Usage
const instance = await client.discoverService('user-service');
if (hasCapability(instance, 'auth')) {
  const token = await client.post&lt;{token: string}&gt;('user-service', '/auth/login', {
    data: { username, password }
  });
}</code></pre>
                                </div>
                            </section>

                            <section class="docs-section">
                                <h2>Framework Integration</h2>

                                <h3>Express.js Integration</h3>
                                <div class="code-block">
                                    <pre><code>import express from 'express';
import { ScoutQuestClient } from 'scoutquest-js';

const app = express();
const client = new ScoutQuestClient('http://localhost:8080');

// Middleware for service discovery
app.use((req, res, next) => {
  req.scoutquest = client;
  next();
});

// Register service on startup
let serviceInstance;
app.listen(3000, async () => {
  serviceInstance = await client.registerService('api-service', 'localhost', 3000, {
    tags: ['api', 'express'],
    healthCheck: { path: '/health' }
  });
  console.log('Server started and registered with ScoutQuest');
});

// Route that calls another service
app.get('/users', async (req, res) => {
  try {
    const users = await req.scoutquest.get('user-service', '/api/users');
    res.json(users.data);
  } catch (error) {
    res.status(500).json({ error: 'Failed to fetch users' });
  }
});

// Health check endpoint
app.get('/health', (req, res) => {
  res.json({ status: 'healthy', timestamp: new Date().toISOString() });
});

// Graceful shutdown
process.on('SIGTERM', async () => {
  if (serviceInstance) {
    await client.deregisterService(serviceInstance.id);
  }
  process.exit(0);
});</code></pre>
                                </div>

                                <h3>Next.js Integration</h3>
                                <div class="code-block">
                                    <pre><code>// lib/scoutquest.ts
import { ScoutQuestClient } from 'scoutquest-js';

let client: ScoutQuestClient;

if (typeof window === 'undefined') {
  // Server-side only
  client = new ScoutQuestClient(process.env.SCOUTQUEST_URL!);
}

export { client };

// pages/api/users.ts
import type { NextApiRequest, NextApiResponse } from 'next';
import { client } from '../../lib/scoutquest';

export default async function handler(req: NextApiRequest, res: NextApiResponse) {
  try {
    const users = await client.get('user-service', '/api/users');
    res.status(200).json(users.data);
  } catch (error) {
    res.status(500).json({ error: 'Failed to fetch users' });
  }
}</code></pre>
                                </div>
                            </section>

                            <section class="docs-section">
                                <h2>Best Practices</h2>

                                <div class="alert alert-info">
                                    <h3>Service Registration</h3>
                                    <ul>
                                        <li>Always register your service on startup</li>
                                        <li>Include meaningful tags for service discovery</li>
                                        <li>Implement proper health check endpoints</li>
                                        <li>Deregister on graceful shutdown</li>
                                    </ul>
                                </div>

                                <div class="alert alert-warning">
                                    <h3>Error Handling</h3>
                                    <ul>
                                        <li>Always wrap service calls in try-catch blocks</li>
                                        <li>Implement retry logic for transient failures</li>
                                        <li>Use circuit breaker patterns for downstream services</li>
                                        <li>Log errors with sufficient context for debugging</li>
                                    </ul>
                                </div>

                                <div class="alert alert-success">
                                    <h3>Performance</h3>
                                    <ul>
                                        <li>Reuse ScoutQuestClient instances</li>
                                        <li>Configure appropriate timeouts and retries</li>
                                        <li>Use connection pooling for high-throughput scenarios</li>
                                        <li>Cache service discovery results when appropriate</li>
                                    </ul>
                                </div>
                            </section>

                            <section class="docs-section">
                                <h2>Examples</h2>
                                <p>Check out these complete examples to see ScoutQuest in action:</p>

                                <div class="example-links">
                                    <a href="https://github.com/RomainDECOSTER/scoutquest/tree/main/examples/js"
                                        class="example-link">
                                        <h3>Express.js Service</h3>
                                        <p>Complete web service with registration, discovery, and health checks</p>
                                    </a>
                                    <a href="https://github.com/RomainDECOSTER/scoutquest/tree/main/examples/js"
                                        class="example-link">
                                        <h3>Client Demo</h3>
                                        <p>Interactive demo showing all SDK features</p>
                                    </a>
                                    <a href="https://github.com/RomainDECOSTER/scoutquest/tree/main/examples/js"
                                        class="example-link">
                                        <h3>Simple Example</h3>
                                        <p>Basic service registration and discovery</p>
                                    </a>
                                </div>
                            </section>
                        </div>
                    </article>
                </div>
            </div>
        </div>
    </main>

    <script src="../assets/js/main.js"></script>
    <script src="../assets/js/docs.js"></script>
    <!-- Prism.js JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script
        src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
</body>

</html>
